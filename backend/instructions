
ssh -i "/Users/thebigsun/Desktop/projects/social_media_project/social_media_project/backend/andrewkey.pem" ubuntu@ec2-107-21-150-23.compute-1.amazonaws.com





sudo apt-get update
sudo apt-get install -y docker.io docker-compose-plugin
sudo usermod -aG docker $USER
newgrp docker
docker --version && docker compose version
sudo apt-get update
sudo apt-get install -y docker.io docker-compose-plugin
sudo usermod -aG docker $USER
newgrp docker
docker --version && docker compose version


# on the server
sudo apt-get update && sudo apt-get install -y git

git config --global credential.helper store   # optional

git clone https://github.com/yongzhe-wang/LocustSocial.git
# When prompted:
#   Username: <your GitHub username>
#   Password: <your Personal Access Token with repo scope>


cd LocustSocial/backend

cp .env.example .env
docker compose up -d --build
docker compose ps


6109022100

cd ~/LocustSocial/backend
docker compose logs -f api



UPDATE FILES

cd ~/LocustSocial
cp backend/.env /tmp/backend.env || true

git fetch --all
git reset --hard origin/main   
# (if you changed branches, use the branch name you pushed instead)

[ -f /tmp/backend.env ] && cp /tmp/backend.env backend/.env

cd ~/LocustSocial/backend
docker compose down
docker compose up -d --build

cd ~/social_media_project/backend
echo "python-multipart==0.0.9" | tee -a requirements.txt

docker compose build --no-cache api
docker compose up -d api
docker compose logs -f api





@@@@@@@@@@Start backend

cd /Users/thebigsun/Desktop/projects/LocustSocial/backend
source venv311/bin/activate
export PG_DSN="postgres://app:secret@localhost:5432/app"
export FIREBASE_WEBHOOK_SECRET=this-is-my-local-secret-locustsocial
set -a; source .env; set +a
python - <<'PY'
import os; print("COHERE_API_KEY present?" , bool(os.environ.get("COHERE_API_KEY")))
print("FIREBASE_WEBHOOK_SECRET present?", bool(os.environ.get("FIREBASE_WEBHOOK_SECRET")))
PY
uvicorn app.main:app --host 0.0.0.0 --port 8000



Check sql

Cd /Users/thebigsun/Desktop/projects/LocustSocial/backend

docker compose exec postgres psql -U app -d app

SELECT id, title, body, created_at, (embedding IS NOT NULL) AS has_embedding
FROM posts
ORDER BY id;


SELECT uid, created_at
FROM users
ORDER BY uid;


SELECT uid, updated_at
FROM user_embeddings
ORDER BY uid;

\q

clear data
TRUNCATE TABLE posts RESTART IDENTITY CASCADE;





@@@@@firebase part
firebase login


cd /Users/thebigsun/Desktop/projects/LocustSocial/firebase/firebase
firebase emulators:start


Update

cd firebase/functions
npm run build




curl -sS -X POST http://127.0.0.1:8000/api/posts \
  -F 'title=hello' \
  -F 'body=world'

curl -sS -X POST http://127.0.0.1:8000/api/posts \
  -F 'title=cat' \
  -F 'body=this is about animals'
sleep 2




curl -sS -X POST http://127.0.0.1:8000/api/search\
  -H 'content-type: application/json' \
  -d '{"q":"animals","limit":5}' | jq












brew install python@3.11
/opt/homebrew/bin/python3.11 -m venv venv311
source venv311/bin/activate
pip install -U pip




Local runs

cd ~/Desktop/projects/LocustSocial/backend
python3 -m venv vena
source venv/bin/activate
pip install --upgrade pip


pip install -r requirements.txt

psql "postgres://app:secret@localhost:5432/app" -f migrations/001_init.sql



docker run --name smp-pg \
  -e POSTGRES_PASSWORD=secret -e POSTGRES_USER=app -e POSTGRES_DB=app \
  -p 5432:5432 -d ankane/pgvector:latest


# make sure the API points to your local Postgres (since youâ€™re not using docker-compose)
export PG_DSN="postgres://app:secret@localhost:5432/app"
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000



cd /Users/thebigsun/Desktop/projects/social_media_project/social_media_project/backend
source venv311/bin/activate
export PG_DSN="postgres://app:secret@localhost:5432/app"
set -a; source .env; set +a
# confirm the key is visible to the process
[ -n "$COHERE_API_KEY" ] && echo "COHERE_API_KEY loaded" || echo "MISSING KEY"

